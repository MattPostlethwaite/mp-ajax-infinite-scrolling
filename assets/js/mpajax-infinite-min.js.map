{"version":3,"sources":["snapback_cache.js","mpajax-infinite.js"],"names":["SnapbackCache","options","SessionStorageHash","set","namespace","key","item","storageHash","sessionStorage","getItem","JSON","parse","stringify","setItem","get","enabled","disable","enable","supported","history","url","value","trimStorage","removeItem","disableAutofocusIfReplacingCachedPage","removeAutofocus","willUseCacheOnThisPage","cachePage","filterOut","callbackFunction","jQuery","document","finish","wait","setTimeout","$cachedBody","bodySelector","clone","find","replaceWith","end","cachedPage","body","html","title","positionY","window","pageYOffset","positionX","pageXOffset","cachedAt","Date","getTime","nextPageOffset","location","href","trigger","loadFromCache","noCacheCallback","scrollTo","dirties","getDirties","refreshItems","clearDirty","raw","json","map","markDirty","tuples","push","length","sort","a","b","i","ready","load","remove","$","setupPage","content","loadPrevPageMessage","prevPageNum","addClass","pageNum","prepend","$window","scrollTop","attr","directURL","placeholderClassName_Prev","before","loadMoreButtonHTML","loadButtonClassName_Prev","messageHTML","placeholderHTML","prevPageURL","nextPageNum","maxPageNum","placeholderClassName_Next","append","nextPageURL","loadButtonClassName_Next","rebuildURL","oldURL","pageStr","query","newURL","_typeof","search","replace","mostylVisible","element","amountVisible","plus","scrollPosition","windowHeight","height","sectionData","section_name","section_url","scrolledAmount","each","self","this","sectionTop","offset","top","Math","round","updateURL","replaceState","windowHeightHalf","sectionEl","visibleSectionURL","lastVisibleSectionURL","loadNextPage","$lastLoadedSection","last","lastLoadedSectionTop","hasClass","loadContent","updateLoadButton","loadPrevPage","$topLoadedSection","topLoadedSectionTop","buttonClass","text","disabled","removeClass","placeholder","loadingDirection","placeholderClassName","loadingDirectionButton","loadButtonClassName","loadingButtonText","loadSpinnerHtml","loadErrorMessageClassName","responseText","textStatus","xhr","readyState","contentLoadError","contentLoadSuccessful","direction","topLoadedSectionHeight","loadingButton","loadErrorMessageClassName_Direction","status","snapbackCacheInit","snapbackCache","nextURL","prevURL","nextNum","prevNum","on","e","loadingCache","checkForPageCache","SSPageCache","pageCache","mpAjaxInfinite","click","preventDefault","documentElement","lastScrollTop","loadButtonWrapperClassName","$totalPageCount","parseInt","mpajax","startPage","isNaN","maxPages","Number","number","dataURL","classes","buttonText","message","messageClass"],"mappings":"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","file":"mpajax-infinite-min.js","sourcesContent":["// Example Usage:\n//   var pageCache = SnapbackCache({\n//     bodySelector: \"#recordings\",\n//   })\n//\n//   pageCache.markDirty(\"comment/1\")\n//\n// Required options:\n//   * bodySelector: Element to be cached and position saved\n// Optional options:\n//   * finish            Pass function to get things on your page to \"finish\" that you don't want to cache in an inbetween state.\n//                       By default we finish jQuery Animations.\n//   * refreshItems      You may mark items dirty in your DOM as things are edited but might still be in the\n//                       page cache, this is a callback for refreshing those dirty items. Using above example\n//                       refreshItems function would be passed arguement [\"comment/1\"]\n//   * removeAutofocus   Pass function to remove items that cause your page to autofocusing. Autofocus behavior can screw with\n//                       setting your scroll position.\n//\n// Events:\n//   * snapback-cache:cached  Triggered when a cache has been set. The cachedPage object is returned with\n//                        the event (triggered on bodySelector)\n//   * snapback-cache:loaded  Triggered when a cache has been loaded. The cachedPage object is returned with\n//                        the event (triggered on bodySelector)\nvar SnapbackCache = (function(options) {\n\tvar options = options || {}\n\n\tvar SessionStorageHash = (function() {\n\t\tvar set = function(namespace, key, item){\n\t\t\tvar storageHash = sessionStorage.getItem(namespace);\n\t\t\tif (!storageHash) {\n\t\t\t\tstorageHash = {}\n\t\t\t} else {\n\t\t\t\tstorageHash = JSON.parse(storageHash)\n\t\t\t}\n\n\t\t\tif (item) {\n\t\t\t\tstorageHash[key] = JSON.stringify(item)\n\t\t\t} else {\n\t\t\t\tdelete storageHash[key]\n\t\t\t}\n\n\t\t\tsessionStorage.setItem(namespace, JSON.stringify(storageHash))\n\t\t}\n\n\t\tvar get = function(namespace, key, item){\n\t\t\tvar storageHash = sessionStorage.getItem(namespace)\n\n\t\t\tif(storageHash){\n\t\t\t\tstorageHash = JSON.parse(storageHash)\n\t\t\t\tif(storageHash[key]){\n\t\t\t\t\treturn JSON.parse(storageHash[key])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null\n\t\t}\n\n\t\treturn {\n\t\t\tset: set,\n\t\t\tget: get\n\t\t}\n\t})()\n\n\tvar enabled = true\n\n\tvar disable = function() {\n\t\tenabled = false\n\t}\n\n\tvar enable = function () {\n\t\tenabled = true\n\t}\n\n\tvar supported = function(){\n\t\treturn !!(sessionStorage && history && enabled)\n\t}\n\n\tvar setItem = function(url, value){\n\t\tif(value){\n\t\t\t// only keep 10 things cached\n\t\t\ttrimStorage()\n\t\t}\n\t\tSessionStorageHash.set(\"pageCache\", url, value)\n\t}\n\n\tvar getItem = function(url){\n\t\treturn SessionStorageHash.get(\"pageCache\", url)\n\t}\n\n\tvar removeItem = function(url){\n\t\tsetItem(url, null)\n\t}\n\n\tvar disableAutofocusIfReplacingCachedPage = function(){\n\t\tif(typeof options.removeAutofocus === \"function\"){\n\t\t\tif(willUseCacheOnThisPage()){\n\t\t\t\toptions.removeAutofocus()\n\t\t\t}\n\t\t}\n\t}\n\n\tvar cachePage = function(filterOut, callbackFunction){\n\t\tif (typeof filterOut === 'function') {\n\t\t\tcallbackFunction = filterOut\n\t\t\tfilterOut = null\n\t\t}\n\n\t\tif (!supported()){\n\t\t\tif(callbackFunction){\n\t\t\t\tcallbackFunction()\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// get jQuery animations to finish\n\t\tjQuery(document).finish()\n\t\tif (typeof options.wait === \"function\")\n\t\t\toptions.finish()\n\n\t\t// Give transitions/animations a chance to finish\n\t\tsetTimeout(function(){\n\t\t\tif (typeof options.removeAutofocus === \"function\")\n\t\t\t\toptions.removeAutofocus()\n\n\t\t\tvar $cachedBody = jQuery(options.bodySelector)\n\t\t\tif (filterOut) {\n\t\t\t\t$cachedBody = $cachedBody.clone().find(filterOut).replaceWith(\"\").end()\n\t\t\t}\n\n\t\t\tvar cachedPage = {\n\t\t\t\tbody: $cachedBody.html(),\n\t\t\t\ttitle: document.title,\n\t\t\t\tpositionY: window.pageYOffset,\n\t\t\t\tpositionX: window.pageXOffset,\n\t\t\t\tcachedAt: new Date().getTime()\n\t\t\t}\n\n\t\t\t// help to setup the next page of infinite scrolling\n\t\t\tif (typeof options.nextPageOffset === \"function\")\n\t\t\t\tcachedPage.nextPageOffset = options.nextPageOffset()\n\n\t\t\tsetItem(document.location.href, cachedPage)\n\n\t\t\tjQuery(options.bodySelector).trigger(\"snapback-cache:cached\", cachedPage)\n\n\t\t\tif(callbackFunction){\n\t\t\t\tcallbackFunction()\n\t\t\t}\n\t\t}, 500)\n\t}\n\n\tvar loadFromCache = function(noCacheCallback){\n\t\t// Check if there is a cache and if its less than 15 minutes old\n\t\tif(willUseCacheOnThisPage()){\n\t\t\tvar cachedPage = getItem(document.location.href)\n\n\t\t\t// replace the content and scroll\n\t\t\tjQuery(options.bodySelector).html(cachedPage.body)\n\n\t\t\t// try to make sure autofocus events don't run.\n\t\t\tif (typeof options.removeAutofocus === \"function\")\n\t\t\t\toptions.removeAutofocus()\n\n\t\t\t// IE 10+ needs a delay to stop the autofocus during dom load\n\t\t\tsetTimeout(function(){\n\t\t\t\twindow.scrollTo(cachedPage.positionX, cachedPage.positionY)\n\t\t\t}, 1);\n\n\t\t\t// pop the cache\n\t\t\tremoveItem(document.location.href)\n\n\t\t\tjQuery(options.bodySelector).trigger(\"snapback-cache:loaded\", cachedPage)\n\n\t\t\t// refresh any obsolete recordings in the activity feed\n\t\t\tvar dirties = getDirties()\n\t\t\tif(dirties){\n\t\t\t\tif (typeof options.refreshItems === \"function\")\n\t\t\t\t\toptions.refreshItems(dirties)\n\n\t\t\t\tclearDirty()\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t\telse{\n\t\t\tif(noCacheCallback){\n\t\t\t\tnoCacheCallback()\n\t\t\t}\n\t\t\telse{\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n\n\tvar clearDirty = function() {\n\t\tsessionStorage.removeItem(\"pageCache-dirty\")\n\t}\n\n\tvar getDirties = function() {\n\t\tvar raw = sessionStorage.getItem(\"pageCache-dirty\")\n\t\tif (raw) {\n\t\t\tvar json = JSON.parse(raw)\n\t\t\treturn jQuery.map(json, function(value, key){\n\t\t\t\treturn key\n\t\t\t})\n\t\t} else {\n\t\t\treturn null\n\t\t}\n\t}\n\n\tvar markDirty = function(item) {\n\t\tSessionStorageHash.set(\"pageCache-dirty\", item, true)\n\t}\n\n\tvar trimStorage = function(){\n\t\tvar storageHash = sessionStorage.getItem(\"pageCache\");\n\t\tif(storageHash){\n\t\t\tstorageHash = JSON.parse(storageHash);\n\n\t\t\tvar tuples = [];\n\n\t\t\tfor (var key in storageHash) {\n\t\t\t\ttuples.push([key, storageHash[key]])\n\t\t\t}\n\t\t\t// if storage is bigger than size, sort them, and remove oldest\n\t\t\tif(tuples.length >= 10){\n\t\t\t\ttuples.sort(function(a, b) {\n\t\t\t\t\t\ta = a[1].cachedAt;\n\t\t\t\t\t\tb = b[1].cachedAt;\n\t\t\t\t\t\treturn b < a ? -1 : (b > a ? 1 : 0);\n\t\t\t\t});\n\n\t\t\t\tfor (var i = 0; i < (tuples.length + 1 - 10); i++) {\n\t\t\t\t\tvar key = tuples[i][0];\n\t\t\t\t\tdelete storageHash[key];\n\t\t\t\t}\n\n\t\t\t\tsessionStorage.setItem(namespace, JSON.stringify(storageHash));\n\t\t\t}\n\t\t}\n\t}\n\n\tvar willUseCacheOnThisPage = function(){\n\t\tif (!supported()){\n\t\t\treturn false;\n\t\t}\n\n\t\tvar cachedPage = getItem(document.location.href)\n\n\t\t// Check if there is a cache and if its less than 15 minutes old\n\t\tif(cachedPage && cachedPage.cachedAt > (new Date().getTime()-900000)){\n\t\t\treturn true;\n\t\t}\n\t\telse{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tjQuery(document).ready(function(){\n\t\tdisableAutofocusIfReplacingCachedPage()\n\t});\n\n\tjQuery(window).load(function(){\n\t\tloadFromCache()\n\t});\n\n\treturn {\n\t\tenable: enable,\n\t\tdisable: disable,\n\t\tremove: removeItem,\n\t\tloadFromCache: loadFromCache,\n\t\tcachePage: cachePage,\n\t\tmarkDirty: markDirty,\n\t\twillUseCacheOnThisPage: willUseCacheOnThisPage\n\t}\n});\n","/**\n *\n * @name mpajax-infinite\n * @file Adds infinite scrolling to paged archives\n * @author Matt Postlethwaite\n *\n * @version 1.0.0\n *\n */\n\n\n( function( $ ) {\n\n\t/* ==========================\n\t * Set Constant Variables\n\t * ========================== */\n\n\t// URL related const\n\tconst directURL = window.location.href; // Directly accessed page link\n\tconst search = window.location.search; // Get the search\n\n\t// Load button related const\n\tconst loadButtonClassName = 'mpajax-load-button'; // Set id for load more button\n\tconst loadButtonWrapperClassName = loadButtonClassName + '-wrapper'; // Set id for load more button\n\tconst loadButtonClassName_Prev = loadButtonClassName + '-prev'; // Set id for load more button\n\tconst loadButtonClassName_Next = loadButtonClassName +'-next'; // Set id for load more button\n\n\t// Placeholder button related const\n\tconst placeholderClassName = 'mpajax-placeholder'; // Define the placeholder class\n\tconst placeholderClassName_Prev = placeholderClassName + '-prev'; // Define the placeholder class\n\tconst placeholderClassName_Next = placeholderClassName + '-next'; // Define the placeholder class\n\n\t// Load related const\n\tconst loadSpinnerHtml = '<i class=\"fa fa-spinner fa-pulse fa-fw\" style=\"width: 14px; height: 14px;\"></i>';\n\tconst loadErrorMessageClassName = 'mpajax-loading-error-message';\n\n\t// Number related const\n\tconst $totalPageCount = $('.total-page-count');\n\tconst pageNum = parseInt(mpajax.startPage); // Current page number\n\tconst maxPageNum = $totalPageCount.length !== 0 && !isNaN($totalPageCount.html()) ? Number($totalPageCount.html()) : parseInt(mpajax.maxPages); // Use max pages or override with total page count element\n\n\t// Other const\n\tconst $window = $(window);\n\n\n\t/* ==========================\n\t * Set Let Variables\n\t * ========================== */\n\t// Page related let\n\tlet prevPageNum = pageNum - 1; // Store prev page number = current page number - 1\n\tlet nextPageNum = pageNum + 1; // Store next page number = current page number + 1\n\tlet prevPageURL = mpajax.prevPageURL; // The URL of the prev page of posts.\n\tlet nextPageURL = mpajax.nextPageURL; // The URL of the next page of posts.\n\n\t// Section related let\n\tlet lastVisibleSectionURL = '';\n\n\t// Other let\n\tlet lastScrollTop = 0;\n\tlet loadingCache = false;\n\n\n\t// =========================================\n\t// Functions\n\t// =========================================\n\n\t/**\n\t *\n\t * @function placeholderHTML()\n\t * @description Html for the placeholder element\n\t * Placeholders are used to load response data into\n\t * @since 1.0.0\n\t *\n\t * @param {int} number - Page number for the placeholder id and data-section-name\n\t * @param {string} dataURL - The URL for the data request\n\t * @param {string} [classes] - Additional classes for this placeholder\n\t *\n\t * @returns {string} placeholder element html\n\t *\n\t */\n\tconst placeholderHTML = function(number, dataURL, classes) {\n\t\treturn '<div id=\"mpajax-content-' + number + '\" class=\"' + placeholderClassName + ' ' + classes + '\" data-section-name=\"mpajax-content-wrapper-page-'+ number +'\" data-section-url=\"' + dataURL + '\"></div>';\n\t};\n\n\n\t/**\n\t *\n\t * @function loadMoreButtonHTML()\n\t * @description Html for the load more button\n\t * @since 1.0.0\n\t *\n\t * @param {int} number - Page number for the placeholder\n\t *\n\t * @returns {string} Load more button\n\t *\n\t */\n\tconst loadMoreButtonHTML = function(buttonText, buttonClass) {\n\t\treturn '<div class=\"' + loadButtonWrapperClassName + ' ' + buttonClass + '-wrapper\" class=\"clearfix\"><button class=\"button ' + loadButtonClassName + ' ' + buttonClass + '\">' + buttonText + '</button></div>';\n\t};\n\n\n\t/**\n\t *\n\t * @function messageHTML()\n\t * @description Html for a message element\n\t * @since 1.0.0\n\t *\n\t * @param {string} message - The text for the message element\n\t * @param {string} [messageClass] - The class for the message element\n\t *\n\t * @returns {string} Load more button\n\t *\n\t */\n\tconst messageHTML = function(message, messageClass) {\n\t\treturn '<div class=\"mpajax-message ' + messageClass + '\"><p>' + message + '</p></div>';\n\t}\n\n\n\t/**\n\t *\n\t * @function setupPage()\n\t * @description Initialise everything needed for ajax to work\n\t * @since 1.0.0\n\t *\n\t * @param {id/class} content - The element to add the loaded content to\n\t *\n\t */\n\tfunction setupPage(content) {\n\n\t\tconst loadPrevPageMessage = prevPageNum > 1 ? 'Scroll up to load the previous pages' : 'Scroll up to load the previous page';\n\n\t\t// Add html class\n\t\t$('html').addClass('mpajax');\n\n\t\t// Was another page other than the first page loaded?\n\t\tif( pageNum != 1 ) {\n\n\t\t\t$('body').prepend('<div class=\"mpajax-spacer\" style=\"height: 10px\"></div>'); // Add spacer\n\n\t\t\t// Check if we are at the top of the document\n\t\t\tif( $window.scrollTop() == 0 ) {\n\t\t\t\twindow.scrollTo(0, 10); // Scroll down to hide the empty space and so user can scroll up\n\t\t\t}\n\n\t\t}\n\n\t\t// Get current page content wrapper ready\n\t\t$(content + ' .cards')\n\t\t\t.attr('id', 'mpajax-content-' + pageNum)\n\t\t\t.addClass('mpajax-content-wrapper loaded')\n\t\t\t.attr('data-section-name', 'mpajax-content-wrapper-page-' + pageNum)\n\t\t\t.attr('data-section-url', directURL);\n\n\t\t// Add prev page loading elements if we have a prev page and we don't already have a placeholder\n\t\tif(prevPageNum !== 0 && $('.' + placeholderClassName_Prev).length === 0)\n\t\t\t$(content + ' .mpajax-content-wrapper.loaded:first').before(\n\t\t\t\tloadMoreButtonHTML('Load Previous', loadButtonClassName_Prev) + '\\n' +\n\t\t\t\tmessageHTML(loadPrevPageMessage, 'load-previous-message') + '\\n' +\n\t\t\t\tplaceholderHTML(prevPageNum, prevPageURL, placeholderClassName_Prev)\n\t\t\t);\n\n\t\t// Add next page loading elements if not last page and we don't already have a placeholder\n\t\tif(nextPageNum <= maxPageNum && $('.' + placeholderClassName_Next).length === 0)\n\t\t\t$(content).append(\n\t\t\t\tplaceholderHTML(nextPageNum, nextPageURL, placeholderClassName_Next) + '\\n' +\n\t\t\t\tloadMoreButtonHTML('Load More', loadButtonClassName_Next)\n\t\t\t);\n\n\t\t// Remove unnecessary elements - (pagination and results count)\n\t\t$('.module-pagination, .woocommerce-pagination, .results-count, .woocommerce-result-count').remove();\n\n\t}\n\n\n\t/**\n\t *\n\t * @function rebuildURL()\n\t * @description Builds page urls\n\t * @since 1.0.0\n\t *\n\t * @param {string} oldURL - The url to change - full url\n\t * @param {string} [pageStr = false] - The new page url part - page/{n}/\n\t * @param {string} [query = (const)search] - The search query string\n\t *\n\t * @returns {string} newURL - The new URL\n\t *\n\t */\n\tfunction rebuildURL(oldURL, pageStr, query) {\n\n\t\tlet newURL = oldURL;\n\t\tpageStr = typeof(pageStr) === typeof('string') ? pageStr : false;\n\t\tquery = typeof(query) === typeof('string') ? query : search;\n\n\t\tif( pageStr ) {\n\t\t\tnewURL = newURL.replace(/page\\/[0-9]*\\//, pageStr ); // Replace old page number with the new page number\n\t\t}\n\n\t\tnewURL = newURL.replace(/\\?(.*)/, query); // Replace the search query\n\n\t\treturn newURL;\n\t}\n\n\t/**\n\t *\n\t * @function mostylVisible()\n\t * @description Checks to see which section is most visible in the viewport\n\t * @since 1.0.0\n\t *\n\t * @param {id/class} element - The element to track\n\t * @param {int} [amountVisible] - The amount of the element that should be visible - relative to the bottom of the window\n\t * @param {boolean} [plus=false] - Whether to add the amountVisible rather than take it away\n\t *\n\t * @returns {object} sectionData - Section url and name\n\t *\n\t */\n\tfunction mostylVisible(element, amountVisible, plus) {\n\n\t\tconst scrollPosition = $window.scrollTop();\n\t\tconst windowHeight = $window.height();\n\t\tconst sectionData = {section_name: '', section_url: ''};\n\t\tlet scrolledAmount = scrollPosition + windowHeight;\n\n\t\t// Check if amountVisible is an int\n\t\tif(typeof(amountVisible) === typeof(1)) {\n\n\t\t\t// Check if plus is a boolean\n\t\t\tif(typeof(plus) !== typeof(true)) {\n\t\t\t\tplus = false; // Set to false\n\t\t\t}\n\n\t\t\t// Plus or Minus?\n\t\t\tif(plus) {\n\t\t\t\tscrolledAmount = scrolledAmount + amountVisible;\n\t\t\t} else {\n\t\t\t\tscrolledAmount = scrolledAmount - amountVisible;\n\t\t\t}\n\t\t}\n\n\t\t$(element).each( function() {\n\t\t\tconst self = $(this);\n\t\t\tconst sectionTop = self.offset().top;\n\n\t\t\t// Check if top of element is less than scrolled amount\n\t\t\tif( Math.round(sectionTop) < Math.round(scrolledAmount) ) {\n\n\t\t\t\t// Set section url from data attribute\n\t\t\t\tsectionData.section_url = self.attr('data-section-url');\n\n\t\t\t\t// Set section name from data attribute\n\t\t\t\tsectionData.section_name = self.attr('data-section-name');\n\n\t\t\t}\n\t\t});\n\n\t\treturn sectionData;\n\t}\n\n\n\t/**\n\t *\n\t * @function updateURL()\n\t * @description Updates the url when the placeholder section is more than half way into the viewport\n\t * @since 1.0.0\n\t *\n\t */\n\tfunction updateURL() {\n\t\t// IE only supports replaceState() in v10 and above, so don't bother if those conditions aren't met.\n\t\tif ( ! window.history.replaceState ) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar windowHeightHalf = Math.round( ($window.height() / 2) );\n\t\tvar sectionEl = '.mpajax-content-wrapper';\n\t\tvar visibleSectionURL = mostylVisible(sectionEl, windowHeightHalf)['section_url']; // Check which section is visible\n\n\t\tif( visibleSectionURL != '' && visibleSectionURL != lastVisibleSectionURL ) {\n\n\t\t\t// Update history state\n\t\t\tif ( window.location.href != visibleSectionURL ) {\n\t\t\t\thistory.replaceState( null, null, visibleSectionURL );\n\t\t\t}\n\n\t\t\tlastVisibleSectionURL = visibleSectionURL;\n\n\t\t}\n\t}\n\n\n\t/**\n\t *\n\t * @function scrollLoadNextPage()\n\t * @description Loads the content from the next page as the user scrolls down\n\t * @since 1.0.0\n\t *\n\t */\n\tfunction loadNextPage() {\n\n\t\tconst windowHeight = $window.height();\n\t\tconst $lastLoadedSection = $('.mpajax-content-wrapper.loaded').last();\n\t\tconst lastLoadedSectionTop = $lastLoadedSection.offset().top;\n\n\t\tif ( Math.round($window.scrollTop() + windowHeight) > Math.round(lastLoadedSectionTop) ) {\n\n\t\t\t// Are there more pages to load?\n\t\t\tif( !$('body').hasClass('loading') && nextPageNum <= maxPageNum ) {\n\t\t\t\tloadContent('#content .cards', nextPageURL, '.' + placeholderClassName_Next); // Load the next page content\n\t\t\t}\n\n\t\t\tif(nextPageNum > maxPageNum) {\n\t\t\t\tupdateLoadButton('.' + loadButtonClassName_Next, 'No more to load', true);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\n\t/**\n\t *\n\t * @function scrollLoadPrevPage()\n\t * @description Loads the content from the previous page as the user scrolls up\n\t * @since 1.0.0\n\t *\n\t */\n\tfunction loadPrevPage() {\n\n\t\tconst $topLoadedSection = $('.mpajax-content-wrapper.loaded:first');\n\t\tconst topLoadedSectionTop = $topLoadedSection.offset().top;\n\n\t\tif ( $window.scrollTop() < topLoadedSectionTop ) {\n\n\t\t\t// Are there previous pages to load?\n\t\t\tif( !$('body').hasClass('loading') && prevPageNum > 0 ) {\n\t\t\t\tloadContent('#content .cards', prevPageURL, '.mpajax-placeholder-prev'); // Load the next page content\n\t\t\t}\n\n\t\t\t$('.mpajax-spacer').remove();\n\n\t\t}\n\t}\n\n\n\t/**\n\t *\n\t * @function updateLoadButton()\n\t * @description Updates the load button text and state\n\t * @since 1.0.0\n\t *\n\t * @param {string} buttonClass - The class of the button to update\n\t * @param {string} text - The text for the updated button\n\t * @param {boolean} disabled - Whether the button should be disabled\n\t *\n\t */\n\tfunction updateLoadButton( buttonClass, text, disabled ) {\n\t\t$(buttonClass).html(text);\n\n\t\tif(disabled) {\n\t\t\t$(buttonClass).addClass('disabled');\n\t\t} else {\n\t\t\t$(buttonClass).removeClass('disabled');\n\t\t}\n\t}\n\n\n\t/**\n\t *\n\t * @function loadContent()\n\t * @description Loads the content\n\t * @since 1.0.0\n\t *\n\t * @param {id/class} content - The content load\n\t * @param {string} url - The url for the load request\n\t * @param {id/class} placeholder - The placeholder to add the loaded content to\n\t *\n\t */\n\tfunction loadContent(content, url, placeholder) {\n\n\t\tconst loadingDirection = placeholder.replace('.' + placeholderClassName + '-' , '');\n\t\tconst loadingDirectionButton = '.' + loadButtonClassName + '-' + loadingDirection;\n\t\tconst loadingButtonText = loadingDirection === 'next' ? 'Load More': 'Load Previous';\n\n\t\t// Add .loading to body for checking if ajax already running\n\t\t$('body').addClass('loading');\n\n\t\t// Show that we're working.\n\t\tupdateLoadButton(loadingDirectionButton, 'Loading more ' + loadSpinnerHtml, true);\n\n\t\t// Remove any loading errors for this direction\n\t\t$('.' + loadErrorMessageClassName + '-' + loadingDirection).remove();\n\n\t\t// Load the content\n\t\t$(placeholder).load( url + ' ' + content,\n\t\t\tfunction(responseText, textStatus, xhr) {\n\n\t\t\t\t// Handle errors\n\t\t\t\tif (xhr.readyState == 4 && textStatus == \"error\") {\n\t\t\t\t\tcontentLoadError(xhr, loadingDirection);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Change the placeholder into a content wrapper\n\t\t\t\t$(this)\n\t\t\t\t\t.removeClass('mpajax-placeholder ' + placeholder.replace('.', ''))\n\t\t\t\t\t.addClass('mpajax-content-wrapper loaded');\n\n\t\t\t\t// Set up for ext ajax call depending on the loading direction\n\t\t\t\tcontentLoadSuccessful(loadingDirection);\n\n\t\t\t\t// Return button to load more state ready for if user needs to click it\n\t\t\t\tupdateLoadButton(loadingDirectionButton, loadingButtonText, false);\n\n\t\t\t\t// Remove the loading class\n\t\t\t\t$('body').removeClass('loading');\n\n\t\t\t}\n\t\t);\n\n\t\treturn false;\n\t}\n\n\n\t/**\n\t *\n\t * @function contentLoadSuccessful()\n\t * @description Runs after a successful .load() and sets up the page ready for the next load\n\t * @since 1.0.0\n\t *\n\t * @param {string} direction - The direction of the loaded content (Should be either 'next' or 'prev')\n\t *\n\t */\n\tfunction contentLoadSuccessful(direction) {\n\t\tif(direction === 'next') {\n\n\t\t\tnextPageNum++; // Increase next page number\n\n\t\t\tnextPageURL = rebuildURL(nextPageURL, 'page/' + nextPageNum + '/'); // Update next page link\n\n\t\t\t// Add a new placeholder, for when function runs again.\n\t\t\tif(nextPageNum <= maxPageNum && $(placeholderClassName_Next).length === 0) {\n\t\t\t\t$('.' + loadButtonClassName_Next + '-wrapper').before( placeholderHTML(nextPageNum,  nextPageURL, placeholderClassName_Next) );\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconst topLoadedSectionHeight = $('.mpajax-content-wrapper.loaded:first').height();\n\t\t\twindow.scrollTo(0, $window.scrollTop() + topLoadedSectionHeight); // Adjust scroll\n\n\t\t\tprevPageNum--;\n\t\t\tprevPageURL = rebuildURL(prevPageURL, 'page/' + prevPageNum + '/'); // Update next page link\n\n\t\t\t// Add a new placeholder, for when function runs again.\n\t\t\tif(prevPageNum !== 0 && $('.' + placeholderClassName_Prev).length === 0) {\n\t\t\t\t$('.mpajax-content-wrapper.loaded:first').before( placeholderHTML(prevPageNum, prevPageURL, placeholderClassName_Prev) );\n\t\t\t}\n\n\t\t\t// We've loaded the first page so we don't need loading elements\n\t\t\tif(prevPageNum === 0) {\n\t\t\t\t$('.' + loadButtonClassName_Prev + '-wrapper, .load-previous-message' ).remove();\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t}\n\t}\n\n\n\t/**\n\t *\n\t * @function contentLoadError()\n\t * @description Runs after a successful .load() and sets up the page ready for the next load\n\t * @since 1.0.0\n\t *\n\t * @param {string} xhr - The xhr response from the ajax call\n\t * @param {string} direction - The direction of the loaded content (Should be either 'next' or 'prev')\n\t *\n\t */\n\tfunction contentLoadError(xhr, direction) {\n\n\t\tconst loadingButton = '.' + loadButtonClassName + '-' + direction;\n\t\tconst loadErrorMessageClassName_Direction = loadErrorMessageClassName + '-' + direction;\n\t\txhr.status = 504\n\t\tif( xhr.status == 404 ) {\n\t\t\t$(loadingButton).before( messageHTML('Sorry we are unable to find the page to load', loadErrorMessageClassName + ' ' + loadErrorMessageClassName_Direction) );\n\t\t\tupdateLoadButton(loadingButton, 'Unable to load', true);\n\t\t} else if ( xhr.status === 500 ) {\n\t\t\t$(loadingButton).before( messageHTML('Sorry something went wrong, please try clicking the load button', loadErrorMessageClassName + ' ' + loadErrorMessageClassName_Direction) );\n\t\t\tdirection == 'next' ? updateLoadButton(loadingButton, 'Load more') : updateLoadButton(loadingButton, 'Load previous');\n\t\t} else {\n\t\t\t$(loadingButton).before( messageHTML('Sorry something went wrong, please try refreshing the page', loadErrorMessageClassName + ' ' + loadErrorMessageClassName_Direction) );\n\t\t\tupdateLoadButton(loadingButton, 'Unable to load', true);\n\t\t}\n\n\t}\n\n\n\t/**\n\t *\n\t * @function snapbackCacheInit()\n\t * @description Initialises snapback_cache.js by highrisehq - https://github.com/highrisehq/snapback_cache\n\t * @since 1.0.0\n\t *\n\t */\n\tfunction snapbackCacheInit() {\n\n\t\t// Snapback settings\n\t\tconst snapbackCache = SnapbackCache({\n\t\t\tbodySelector: \"#content\",\n\t\t\tnextPageOffset: function () {\n\t\t\t\tconst pageOffset = {\n\t\t\t\t\tnextURL: nextPageURL,\n\t\t\t\t\tprevURL: prevPageURL,\n\t\t\t\t\tnextNum: nextPageNum,\n\t\t\t\t\tprevNum: prevPageNum\n\t\t\t\t}\n\t\t\t\treturn pageOffset;\n\t\t\t}\n\t\t});\n\n\n\t\t// When snapback cache has loaded\n\t\t$(\"#content\").on(\"snapback-cache:loaded\", function(e, cachedPage) {\n\n\t\t\t// Updates loading vars with the cached paged offsets\n\t\t\tnextPageURL = cachedPage.nextPageOffset.nextURL;\n\t\t\tnextPageNum = cachedPage.nextPageOffset.nextNum;\n\t\t\tprevPageURL = cachedPage.nextPageOffset.prevURL;\n\t\t\tprevPageNum = cachedPage.nextPageOffset.prevNum;\n\n\t\t\tloadingCache = false; // Reset so more pages can be loaded\n\t\t});\n\n\n\t\t// Cache page on content anchor click\n\t\t$(document).on(\"click\", \"a\", function () {\n\t\t\tsnapbackCache.cachePage();\n\t\t});\n\n\n\t\t// Check to see if we have a cache for this page\n\t\t(function checkForPageCache() {\n\n\t\t\tlet SSPageCache = sessionStorage.pageCache;\n\n\t\t\tif( SSPageCache ) {\n\t\t\t\tSSPageCache = JSON.parse(SSPageCache);\n\n\t\t\t\t// Check if to see if we don't have a pageCache for this page in the session storage before saving a new cache\n\t\t\t\tif( SSPageCache[window.location.href] ) {\n\t\t\t\t\tloadingCache = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t})();\n\n\t}\n\n\n\t/**\n\t *\n\t * @function mpAjaxInfinite()\n\t * @description Initialises everything!\n\t * @since 1.0.0\n\t *\n\t */\n\tfunction mpAjaxInfinite() {\n\n\t\tsnapbackCacheInit();\n\n\t\t$(document).on('ready', function() {\n\n\t\t\t// Set up the page structure ready for loading content\n\t\t\tsetupPage('#content');\n\n\t\t\tif( !loadingCache ) {\n\n\t\t\t\t// Load prev page when the link is clicked.\n\t\t\t\t$('.' + loadButtonClassName_Prev).click(function(e) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Check if button is not disabled\n\t\t\t\t\t// Stops user making an ajax call when one is already running\n\t\t\t\t\tif( !$(this).hasClass('disabled') ) {\n\t\t\t\t\t\tloadContent('#content .cards', prevPageURL, '.mpajax-placeholder-prev'); // Load the prev page content\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Load next page when the link is clicked.\n\t\t\t\t$('.' + loadButtonClassName_Next).click(function(e) {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// Check if button is not disabled\n\t\t\t\t\t// Stops user making an ajax call when one is already running\n\t\t\t\t\tif( !$(this).hasClass('disabled') ) {\n\t\t\t\t\t\tloadContent('#content .cards', nextPageURL, '.mpajax-placeholder-next'); // Load the next page content\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\t\t});\n\n\t\t// Handle scrolling\n\t\t$window.on('scroll', function() {\n\t\t\tif( !loadingCache ) {\n\n\t\t\t\tconst scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n\n\t\t\t\tupdateURL(); // Update the browser url\n\n\t\t\t\tif(scrollTop > lastScrollTop) { // Scrolling down\n\t\t\t\t\tlastScrollTop = scrollTop;\n\t\t\t\t\tloadNextPage();\n\t\t\t\t} else { // Scrolling up\n\t\t\t\t\tlastScrollTop = scrollTop;\n\t\t\t\t\tloadPrevPage();\n\t\t\t\t}\n\n\t\t\t}\n\t\t});\n\t}\n\tmpAjaxInfinite(); // Initialise mpajax infinite scrolling\n\n} )( jQuery );\n"]}