var SnapbackCache=function(e){var e=e||{},t=function(){return{set:function(e,t,n){var o=sessionStorage.getItem(e);o=o?JSON.parse(o):{},n?o[t]=JSON.stringify(n):delete o[t],sessionStorage.setItem(e,JSON.stringify(o))},get:function(e,t,n){var o=sessionStorage.getItem(e);return o&&(o=JSON.parse(o),o[t])?JSON.parse(o[t]):null}}}(),n=!0,o=function(){n=!1},r=function(){n=!0},i=function(){return!!(sessionStorage&&history&&n)},c=function(e,n){n&&h(),t.set("pageCache",e,n)},a=function(e){return t.get("pageCache",e)},u=function(e){c(e,null)},f=function(){"function"==typeof e.removeAutofocus&&p()&&e.removeAutofocus()},s=function(t,n){if("function"==typeof t&&(n=t,t=null),!i())return void(n&&n());jQuery(document).finish(),"function"==typeof e.wait&&e.finish(),setTimeout(function(){"function"==typeof e.removeAutofocus&&e.removeAutofocus();var o=jQuery(e.bodySelector);t&&(o=o.clone().find(t).replaceWith("").end());var r={body:o.html(),title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset,cachedAt:(new Date).getTime()};"function"==typeof e.nextPageOffset&&(r.nextPageOffset=e.nextPageOffset()),c(document.location.href,r),jQuery(e.bodySelector).trigger("snapback-cache:cached",r),n&&n()},500)},g=function(t){if(p()){var n=a(document.location.href);jQuery(e.bodySelector).html(n.body),"function"==typeof e.removeAutofocus&&e.removeAutofocus(),setTimeout(function(){window.scrollTo(n.positionX,n.positionY)},1),u(document.location.href),jQuery(e.bodySelector).trigger("snapback-cache:loaded",n);var o=l();return o&&("function"==typeof e.refreshItems&&e.refreshItems(o),d()),!1}t&&t()},d=function(){sessionStorage.removeItem("pageCache-dirty")},l=function(){var e=sessionStorage.getItem("pageCache-dirty");if(e){var t=JSON.parse(e);return jQuery.map(t,function(e,t){return t})}return null},m=function(e){t.set("pageCache-dirty",e,!0)},h=function(){var e=sessionStorage.getItem("pageCache");if(e){e=JSON.parse(e);var t=[];for(var n in e)t.push([n,e[n]]);if(t.length>=10){t.sort(function(e,t){return e=e[1].cachedAt,t=t[1].cachedAt,t<e?-1:t>e?1:0});for(var o=0;o<t.length+1-10;o++){var n=t[o][0];delete e[n]}sessionStorage.setItem(namespace,JSON.stringify(e))}}},p=function(){if(!i())return!1;var e=a(document.location.href);return!!(e&&e.cachedAt>(new Date).getTime()-9e5)};return jQuery(document).ready(function(){f()}),jQuery(window).load(function(){g()}),{enable:r,disable:o,remove:u,loadFromCache:g,cachePage:s,markDirty:m,willUseCacheOnThisPage:p}};
//# sourceMappingURL=./snapback_cache-min.js.map